<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastery Command Center</title>
    <style>
        :root {
            --bg: #050505; --surface: #111; --accent: #00f2ff;
            --success: #00ff88; --danger: #ff4444; --text: #fff; --text-dim: #666;
        }

        body {
            background: var(--bg); color: var(--text);
            font-family: 'Inter', system-ui, sans-serif; margin: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow-x: hidden;
        }

        /* --- MOTIVATION BAR --- */
        #vision-bar {
            width: 100%; background: #000; padding: 15px 0;
            border-bottom: 1px solid #222; text-align: center;
            font-size: 0.85rem; letter-spacing: 2px; color: var(--accent);
            font-weight: bold; text-transform: uppercase;
        }

        /* --- LOCK SCREEN --- */
        #lock-screen {
            position: fixed; inset: 0; background: var(--bg);
            display: flex; justify-content: center; align-items: center; z-index: 10000;
        }
        #pin-input {
            background: #000; border: 2px solid var(--accent); color: var(--accent);
            font-size: 3rem; width: 180px; text-align: center; border-radius: 12px;
        }

        /* --- MAIN UI --- */
        #main-ui { display: none; width: 95%; max-width: 1200px; padding: 30px; flex-direction: column; }
        
        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        
        /* DATE NAV */
        .date-nav { display: flex; align-items: center; gap: 20px; }
        .nav-arrow { 
            background: var(--surface); border: 1px solid #333; color: white; 
            font-size: 1.5rem; padding: 10px 20px; border-radius: 10px; cursor: pointer;
        }
        .nav-arrow:focus { background: var(--accent); color: black; outline: none; }
        
        #date-header { font-size: 3.5rem; font-weight: 900; margin: 0; letter-spacing: -2px; }

        /* --- HABITS --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
        .card {
            background: var(--surface); padding: 25px; border-radius: 15px; border: 1px solid #222;
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: space-between;
        }
        .card:focus, .card:hover { border-color: var(--accent); outline: none; background: #1a1a1a; }
        .card.done { border-color: var(--success); }

        .delete-btn { 
            background: none; border: none; color: #444; font-size: 1.2rem; 
            cursor: pointer; padding: 5px 10px; border-radius: 5px;
        }
        .delete-btn:focus { background: var(--danger); color: white; outline: none; }

        .btn-group { margin-top: 40px; display: flex; gap: 10px; flex-wrap: wrap; }
        .btn {
            background: #222; color: #fff; padding: 15px 30px; border-radius: 10px;
            border: 1px solid #333; cursor: pointer; font-weight: bold;
        }
        .btn:focus { background: var(--accent); color: #000; outline: none; }

        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; justify-content: center; align-items: center; z-index: 5000;
        }
        .modal-content { background: var(--surface); width: 90%; max-width: 800px; padding: 40px; border-radius: 20px; border: 1px solid #333; }
    </style>
</head>
<body>

    <div id="vision-bar">Loading Motivation...</div>

    <div id="lock-screen">
        <input type="password" id="pin-input" maxlength="4" placeholder="PIN" autofocus>
    </div>

    <div id="main-ui">
        <div class="header-flex">
            <div class="date-nav">
                <button class="nav-arrow" onclick="changeDate(-1)">←</button>
                <div>
                    <p id="day-header" style="color: var(--accent); margin:0; letter-spacing:3px; text-transform:uppercase;"></p>
                    <h1 id="date-header"></h1>
                </div>
                <button class="nav-arrow" onclick="changeDate(1)">→</button>
            </div>
            <div style="text-align: right;">
                <div id="streak-val" style="font-size: 2rem; font-weight: bold; color: var(--success);">0</div>
                <div style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase;">Perfect Days</div>
            </div>
        </div>

        <div class="grid" id="habit-grid"></div>

        <div class="btn-group">
            <button class="btn" onclick="toggleModal(true)">ANALYSIS</button>
            <button class="btn" onclick="addHabit()">+ NEW HABIT</button>
            <button class="btn" onclick="resetDayProgress()" style="color: var(--danger)">RESET PROGRESS</button>
            <button class="btn" onclick="clearAllHabits()" style="border-color: var(--danger)">DELETE ALL HABITS</button>
        </div>
    </div>

    <div id="modal" onclick="toggleModal(false)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2>Monthly Overview</h2>
            <div id="calendar-view" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;"></div>
            <button class="btn" style="width:100%; margin-top:20px;" onclick="toggleModal(false)">CLOSE</button>
        </div>
    </div>

    <script>
        const PIN = "8472";
        const quotes = [
            "We are what we repeatedly do. Excellence, then, is not an act, but a habit.",
            "The pain of discipline or the pain of regret.",
            "He who has a why to live can bear almost any how.",
            "Discipline is choosing between what you want now and what you want most."
        ];

        let viewingDate = new Date();
        let habitsTemplate = JSON.parse(localStorage.getItem('h-template')) || [];
        let history = JSON.parse(localStorage.getItem('h-history-v6')) || {};

        document.getElementById('pin-input').addEventListener('input', (e) => {
            if(e.target.value === PIN) {
                document.getElementById('lock-screen').style.display='none';
                document.getElementById('main-ui').style.display='flex';
                init();
            }
        });

        function init() {
            setQuote();
            render();
            // Auto-check for midnight every minute
            setInterval(() => {
                if (new Date().getHours() === 0 && new Date().getMinutes() === 0) {
                    location.reload(); 
                }
            }, 60000);
        }

        function setQuote() {
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
            document.getElementById('vision-bar').innerText = quotes[dayOfYear % quotes.length];
        }

        function render() {
            const dateStr = viewingDate.toISOString().split('T')[0];
            const dayData = history[dateStr] || { completed: [] };
            
            // Header
            document.getElementById('date-header').innerText = viewingDate.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
            document.getElementById('day-header').innerText = viewingDate.toLocaleDateString(undefined, { weekday: 'long' });

            const grid = document.getElementById('habit-grid');
            grid.innerHTML = '';

            habitsTemplate.forEach((h, index) => {
                const isDone = dayData.completed.includes(h.id);
                const card = document.createElement('div');
                card.className = `card ${isDone ? 'done' : ''}`;
                card.tabIndex = 0;
                card.innerHTML = `
                    <div onclick="toggleHabit('${h.id}')" style="flex:1; display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size: 1.3rem; font-weight: 500;">${h.name}</span>
                        <span style="font-size: 1.5rem;">${isDone ? '✦' : '✧'}</span>
                    </div>
                    <button class="delete-btn" onclick="deleteHabit('${h.id}')">✕</button>
                `;
                grid.appendChild(card);
            });
            updateStats();
        }

        function toggleHabit(id) {
            const dateStr = viewingDate.toISOString().split('T')[0];
            if (!history[dateStr]) history[dateStr] = { completed: [] };
            
            const index = history[dateStr].completed.indexOf(id);
            if (index > -1) history[dateStr].completed.splice(index, 1);
            else history[dateStr].completed.push(id);
            
            save();
        }

        function changeDate(offset) {
            viewingDate.setDate(viewingDate.getDate() + offset);
            render();
        }

        function addHabit() {
            const n = prompt("Define New Habit:");
            if(n) {
                const id = 'h-' + Date.now();
                habitsTemplate.push({ id, name: n });
                save();
            }
        }

        function deleteHabit(id) {
            if(confirm("Remove this habit from your daily list?")) {
                habitsTemplate = habitsTemplate.filter(h => h.id !== id);
                save();
            }
        }

        function resetDayProgress() {
            const dateStr = viewingDate.toISOString().split('T')[0];
            if(history[dateStr]) {
                history[dateStr].completed = [];
                save();
            }
        }

        function clearAllHabits() {
            if(confirm("Erase all habits and start a new list?")) {
                habitsTemplate = [];
                save();
            }
        }

        function save() {
            localStorage.setItem('h-template', JSON.stringify(habitsTemplate));
            localStorage.setItem('h-history-v6', JSON.stringify(history));
            render();
        }

        function updateStats() {
            let streak = 0;
            const dates = Object.keys(history).sort().reverse();
            for(let d of dates) {
                const day = history[d];
                if(habitsTemplate.length > 0 && day.completed.length === habitsTemplate.length) streak++;
                else if (d === new Date().toISOString().split('T')[0]) continue; 
                else break;
            }
            document.getElementById('streak-val').innerText = streak;
        }

        function toggleModal(s) {
            document.getElementById('modal').style.display = s ? 'flex' : 'none';
        }

        // TV Remote Navigation
        window.addEventListener('keydown', (e) => {
            const f = document.querySelectorAll('.card, .btn, .nav-arrow, .delete-btn');
            let i = Array.from(f).indexOf(document.activeElement);
            if(e.key==='ArrowRight'||e.key==='ArrowDown') i=(i+1)%f.length;
            if(e.key==='ArrowLeft'||e.key==='ArrowUp') i=(i-1+f.length)%f.length;
            if(f[i]) f[i].focus();
        });
    </script>
</body>
</html>
