<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Command Center</title>
    <style>
        :root {
            --bg: #050505; --surface: #111; --accent: #00f2ff;
            --success: #00ff88; --text: #fff; --text-dim: #666; --danger: #ff4444;
        }

        body {
            background: var(--bg); color: var(--text);
            font-family: 'Inter', system-ui, sans-serif; margin: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow-x: hidden;
        }

        /* --- PULSE BAR (URGENCY) --- */
        #pulse-bar {
            width: 100%; background: #000; padding: 12px 0;
            border-bottom: 1px solid #222; display: flex;
            justify-content: space-around; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 2px; color: var(--accent);
        }

        /* --- LOCK SCREEN --- */
        #lock-screen {
            position: fixed; inset: 0; background: var(--bg);
            display: flex; justify-content: center; align-items: center; z-index: 10000;
        }
        #pin-input {
            background: #000; border: 2px solid var(--accent); color: var(--accent);
            font-size: 3rem; width: 180px; text-align: center; border-radius: 12px;
        }

        /* --- MAIN UI --- */
        #main-ui { display: none; width: 95%; max-width: 1200px; padding: 30px; flex-direction: column; }
        
        .header-flex { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px; }
        
        /* DATE NAV */
        .date-nav { display: flex; align-items: center; gap: 20px; }
        .nav-arrow {
            background: transparent; border: 1px solid #333; color: var(--accent);
            font-size: 1.5rem; cursor: pointer; padding: 10px 15px; border-radius: 8px;
            transition: 0.2s; user-select: none;
        }
        .nav-arrow:hover { background: var(--accent); color: #000; }
        .date-wrapper { text-align: center; }

        #date-header { font-size: 4rem; font-weight: 900; margin: 0; letter-spacing: -3px; line-height: 1; }
        #day-header { color: var(--accent); margin:0; letter-spacing:3px; font-size: 1.2rem; }
        
        .stats-box { text-align: right; }
        .stat-val { font-size: 2rem; font-weight: bold; color: var(--success); }
        .stat-lbl { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; }

        /* --- HABITS --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        
        .card {
            background: var(--surface); padding: 20px 25px; border-radius: 15px; border: 1px solid #222;
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: space-between;
        }
        .card:focus, .card:hover { border-color: var(--accent); outline: none; background: #1a1a1a; transform: translateY(-3px); }
        .card.done { border-color: var(--success); }
        .card.done .check { color: var(--success); text-shadow: 0 0 10px var(--success); }

        /* Delete Button Styles */
        .delete-btn {
            background: transparent; border: none; color: #333; font-size: 1.5rem;
            cursor: pointer; padding: 0 0 0 15px; line-height: 1; transition: 0.2s;
        }
        .delete-btn:hover { color: var(--danger); transform: scale(1.1); }

        /* --- GRAPH AREA --- */
        #performance-section { margin-top: 40px; background: var(--surface); padding: 20px; border-radius: 15px; border: 1px solid #222; }
        .graph-container { display: flex; align-items: flex-end; height: 100px; gap: 10px; margin-top: 20px; }
        .bar { flex: 1; background: var(--accent); border-radius: 4px 4px 0 0; min-height: 2px; transition: 0.5s; position: relative; }
        .bar:hover::after { content: attr(data-label); position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 0.6rem; color: white; }

        /* --- MODAL --- */
        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; justify-content: center; align-items: center; z-index: 5000;
        }
        .modal-content {
            background: var(--surface); width: 90%; max-width: 1000px; padding: 40px; border-radius: 20px;
            display: flex; gap: 30px; border: 1px solid #333;
        }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; flex: 2; }
        .day-cell { aspect-ratio: 1; background: #000; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; border: 1px solid #222; }
        .day-cell.perfect { background: var(--success) !important; color: #000; font-weight: bold; }
        .details-pane { flex: 1; background: #050505; padding: 20px; border-radius: 10px; }

        .btn {
            background: #222; color: #fff; padding: 12px 24px; border-radius: 8px;
            border: 1px solid #333; cursor: pointer; font-weight: bold; margin-top: 20px;
        }
        .btn:focus { background: var(--accent); color: #000; outline: none; }
    </style>
</head>
<body>

    <div id="pulse-bar">
        <span id="countdown-timer">Goal Loading...</span>
        <span>•</span>
        <span id="year-progress">Year Progress: 0%</span>
    </div>

    <div id="lock-screen">
        <input type="password" id="pin-input" maxlength="4" placeholder="PIN" autofocus>
    </div>

    <div id="main-ui">
        <div class="header-flex">
            <div class="date-nav">
                <button class="nav-arrow" onclick="changeDate(-1)">&#9664;</button>
                <div class="date-wrapper">
                    <p id="day-header"></p>
                    <h1 id="date-header"></h1>
                </div>
                <button class="nav-arrow" onclick="changeDate(1)">&#9654;</button>
            </div>

            <div class="stats-box">
                <div id="streak-val" class="stat-val">0</div>
                <div class="stat-lbl">Power Streak</div>
            </div>
        </div>

        <div class="grid" id="habit-grid"></div>

        <div id="performance-section">
            <div class="stat-lbl">7-Day Performance Trend</div>
            <div class="graph-container" id="trend-graph"></div>
        </div>

        <div style="display:flex; gap:10px;">
            <button class="btn" onclick="toggleModal(true)">ANALYSIS</button>
            <button class="btn" onclick="addHabit()">+ HABIT</button>
            <button class="btn" onclick="resetDay()">RESET PROGRESS</button>
        </div>
    </div>

    <div id="modal" onclick="toggleModal(false)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="calendar-grid" id="calendar"></div>
            <div class="details-pane">
                <h3 id="det-date" style="color: var(--accent)">Select Day</h3>
                <ul id="det-list" style="font-size: 0.9rem; line-height: 1.6;"></ul>
            </div>
        </div>
    </div>

    <script>
        const PIN = "8472";
        const GOAL_DATE = new Date("2026-06-15"); 
        
        let habits = JSON.parse(localStorage.getItem('h-v5')) || [];
        let history = JSON.parse(localStorage.getItem('hist-v5')) || {};
        let viewOffset = 0; 

        document.getElementById('pin-input').addEventListener('input', (e) => {
            if(e.target.value === PIN) {
                document.getElementById('lock-screen').style.display='none';
                document.getElementById('main-ui').style.display='flex';
                init();
            }
        });

        function init() {
            updateUrgency();
            checkDayReset();
            render();
            renderGraph();
        }

        function getViewDate() {
            const d = new Date();
            d.setDate(d.getDate() + viewOffset);
            return d;
        }
        
        function getDateString(dateObj) {
            return dateObj.toISOString().split('T')[0];
        }

        function changeDate(dir) {
            viewOffset += dir;
            render();
        }

        function updateUrgency() {
            const now = new Date();
            const diff = GOAL_DATE - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            document.getElementById('countdown-timer').innerText = `T-MINUS ${days} DAYS UNTIL MISSION`;
            
            const start = new Date(now.getFullYear(), 0, 1);
            const end = new Date(now.getFullYear() + 1, 0, 1);
            const prog = ((now - start) / (end - start) * 100).toFixed(1);
            document.getElementById('year-progress').innerText = `Year Progress: ${prog}%`;
        }

        function render() {
            const grid = document.getElementById('habit-grid');
            grid.innerHTML = '';
            
            const viewDate = getViewDate();
            const viewDateStr = getDateString(viewDate);
            const isToday = viewOffset === 0;

            document.getElementById('date-header').innerText = viewDate.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
            document.getElementById('day-header').innerText = viewDate.toLocaleDateString(undefined, { weekday: 'long' }) + (viewOffset === 0 ? " (Today)" : "");

            habits.forEach((h, index) => {
                let isDone = false;
                
                if (isToday) {
                    isDone = h.done;
                } else {
                    const record = history[viewDateStr];
                    if (record && record.items.includes(h.name)) {
                        isDone = true;
                    }
                }

                const card = document.createElement('div');
                card.className = `card ${isDone ? 'done' : ''}`;
                card.tabIndex = 0;
                
                // Content Structure: Name | Check | Delete
                card.innerHTML = `
                    <div style="flex-grow:1">${h.name}</div>
                    <div style="display:flex; align-items:center;">
                        <div class="check">${isDone ? '✦' : '✧'}</div>
                    </div>
                `;

                // Add delete button programmatically to handle events safely
                const delBtn = document.createElement('button');
                delBtn.innerHTML = '&times;';
                delBtn.className = 'delete-btn';
                delBtn.title = "Delete Habit";
                delBtn.onclick = (e) => {
                    e.stopPropagation(); // Prevents clicking the card background
                    deleteHabit(index);
                };

                // Append delete button to the right side flex container
                card.querySelector('div:last-child').appendChild(delBtn);

                card.onclick = () => toggleHabit(index, h.name, viewDateStr);
                card.onkeydown = (e) => { if(e.key === 'Enter') toggleHabit(index, h.name, viewDateStr); };
                
                grid.appendChild(card);
            });
            updateStats();
        }

        function toggleHabit(index, name, dateStr) {
            const isToday = (dateStr === getDateString(new Date()));

            if (isToday) {
                habits[index].done = !habits[index].done;
                localStorage.setItem('h-v5', JSON.stringify(habits));
            }

            if (!history[dateStr]) history[dateStr] = { score: 0, items: [] };
            
            const histItems = history[dateStr].items;
            const itemIndex = histItems.indexOf(name);

            if (itemIndex > -1) histItems.splice(itemIndex, 1);
            else histItems.push(name);

            history[dateStr].score = habits.length ? histItems.length / habits.length : 0;
            localStorage.setItem('hist-v5', JSON.stringify(history));

            render();
            renderGraph();
        }

        function deleteHabit(index) {
            if(confirm("Are you sure you want to permanently delete this habit?")) {
                habits.splice(index, 1); // Remove from array
                save();
                render();
            }
        }

        function save() {
            localStorage.setItem('h-v5', JSON.stringify(habits));
            const todayStr = getDateString(new Date());
            history[todayStr] = { 
                score: habits.length ? habits.filter(x=>x.done).length / habits.length : 0,
                items: habits.filter(x=>x.done).map(x=>x.name)
            };
            localStorage.setItem('hist-v5', JSON.stringify(history));
        }

        function updateStats() {
            let streak = 0;
            const dates = Object.keys(history).sort().reverse();
            for(let d of dates) {
                if(history[d].score === 1) streak++;
                else break;
            }
            document.getElementById('streak-val').innerText = streak;
        }

        function renderGraph() {
            const container = document.getElementById('trend-graph');
            container.innerHTML = '';
            for(let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const ds = getDateString(d);
                const score = history[ds] ? history[ds].score : 0;
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = (score * 100) + '%';
                bar.setAttribute('data-label', `${Math.round(score*100)}%`);
                container.appendChild(bar);
            }
        }

        function toggleModal(s) {
            document.getElementById('modal').style.display = s ? 'flex' : 'none';
            if(s) renderCalendar();
        }

        function renderCalendar() {
            const cal = document.getElementById('calendar'); cal.innerHTML = '';
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            for(let d=1; d<=daysInMonth; d++) {
                const ds = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const data = history[ds];
                const cell = document.createElement('div');
                cell.className = 'day-cell' + (data?.score === 1 ? ' perfect' : '');
                cell.innerText = d;
                cell.onmouseover = () => {
                    document.getElementById('det-date').innerText = `Day ${d}`;
                    document.getElementById('det-list').innerHTML = data ? data.items.map(i=>`<li>${i}</li>`).join('') : 'No data';
                };
                cal.appendChild(cell);
            }
        }

        function addHabit() { 
            const n = prompt("New Habit:"); 
            if(n) { habits.push({name:n, done:false}); save(); render(); } 
        }
        
        function checkDayReset() {
            const t = getDateString(new Date());
            if(localStorage.getItem('l-d') !== t) {
                habits.forEach(h=>h.done=false);
                localStorage.setItem('l-d', t);
                save();
            }
        }
        function resetDay() { 
            if(confirm("This will uncheck all boxes for today. Continue?")) { 
                habits.forEach(h=>h.done=false); 
                save(); 
                render();
            } 
        }

        // TV Nav
        window.addEventListener('keydown', (e) => {
            const f = document.querySelectorAll('.card, .btn, .day-cell, .nav-arrow');
            let i = Array.from(f).indexOf(document.activeElement);
            if(e.key==='ArrowRight'||e.key==='ArrowDown') i=(i+1)%f.length;
            if(e.key==='ArrowLeft'||e.key==='ArrowUp') i=(i-1+f.length)%f.length;
            if(f[i]) f[i].focus();
        });
    </script>
</body>
</html>
